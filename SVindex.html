<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>Shadowverse EVOLVE 確率シミュレーター</title>

<style>
body{
  font-family: sans-serif;
  color: #e6edf3;
  padding: 20px;
  margin: 0;

  /* 背景画像（ここを自分の画像名に変更） */
  background:
    linear-gradient(rgba(13,17,23,0.88), rgba(13,17,23,0.88)),
    url("imag/SVhaikei.jpg");

  background-size: cover;
  background-position: center;
  background-attachment: fixed;
}

input,select,button{
  padding:6px;
  margin:4px;
  font-size:14px;
}

/* パネル */
.panel{
  background: rgba(22,27,34,0.92);
  padding:16px;
  border-radius:12px;
  max-width:600px;
  margin-bottom:20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

.result{
  white-space:pre;
  font-family:monospace;
  background: rgba(11,15,20,0.95);
  padding:12px;
  border-radius:8px;
}

label{
  display:inline-block;
  width:220px;
}

a{
  color:#58a6ff;
  text-decoration:none;
}

a:hover{
  text-decoration:underline;
}
</style>

</head>
<body>

<h1>Shadowverse EVOLVE 確率シミュレーター</h1>
<p>・出力は <strong>「マリガンも含めて指定ターンまでに特定カードを引ける確率」</strong> のみです。</p>

<div class="panel">
  <h2>設定</h2>
  <div><label>デッキ枚数 (N)</label> <input id="deckSize" type="number" value="40" min="1" /></div>
  <div><label>採用枚数（目的カードの枚数 T）</label> <input id="targetCount" type="number" value="3" min="0" /></div>
  <div><label>初手（マリガン後）= 固定</label> <input id="handSize" type="number" value="4" disabled /></div>
  <div><label>Nターン目までに引ける確率を計算（ターン数）</label> <input id="turns" type="number" value="4" min="1" /></div>
  <div>
    <label>先攻 / 後攻</label>
    <select id="turnOrder">
      <option value="first">先攻（1ターン目のドローなし）</option>
      <option value="second">後攻（1ターン目からドローあり）</option>
    </select>
  </div>
  <div><button id="runBtn">計算する</button></div>
</div>

<div class="panel">
  <h2>結果</h2>
  <div class="result" id="result">ここに結果が表示されます</div>
</div>

<script>
// 組み合わせ nCr
function nCr(n, r){
  if(r < 0 || r > n) return 0;
  r = Math.min(r, n - r);
  let num = 1, den = 1;
  for(let i = 0; i < r; i++){
    num *= (n - i);
    den *= (i + 1);
  }
  return num / den;
}

// マリガン込み確率
function probabilityWithMulligan(deckSize, targetCount, handSize, turns, isFirst){
  if(targetCount <= 0) return 0;
  if(targetCount >= deckSize) return 1;

  const draws = isFirst ? Math.max(0, turns - 1) : turns;
  const totalDraws = Math.min(deckSize, handSize + draws);

  const noHit =
    nCr(deckSize - targetCount, totalDraws) /
    nCr(deckSize, totalDraws);

  return 1 - noHit;
}

document.getElementById('runBtn').addEventListener('click', function(){
  const deckSize = Math.floor(+document.getElementById('deckSize').value);
  const targetCount = Math.floor(+document.getElementById('targetCount').value);
  const handSize = 4;
  const turns = Math.floor(+document.getElementById('turns').value);
  const isFirst = document.getElementById('turnOrder').value === 'first';

  if(deckSize <= 0){
    result.textContent = 'デッキ枚数を正しく入力してください。';
    return;
  }
  if(targetCount < 0){
    result.textContent = '採用枚数を正しく入力してください。';
    return;
  }
  if(targetCount === 0){
    result.textContent = '採用枚数が0枚なので確率は0%です。';
    return;
  }
  if(targetCount > deckSize){
    result.textContent = '採用枚数がデッキ枚数を超えています。';
    return;
  }

  const prob = probabilityWithMulligan(deckSize, targetCount, handSize, turns, isFirst);
  result.textContent =
    `▼ マリガンも含めて ${turns}ターン目までに少なくとも1枚引ける確率\n` +
    `${(prob * 100).toFixed(4)}%`;
});
</script>

<p>
  <a href="DMindex.html">→ デュエマ シミュレーターへ</a>
</p>
<p>
  <a href="index.html">→ トップページに戻る</a>
</p>

</body>
</html>